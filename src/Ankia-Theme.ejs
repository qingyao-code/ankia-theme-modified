<!--
    Ankia-Theme (modified) v1.0
    Original: https://ankia.top/ | Fork: https://github.com/dvai/Ankia-Theme
    Modified by æ¸…é¥
    https://github.com/qingyao-code/ankia-theme-modified

    Licensed under the Apache License, Version 2.0
    Original copyright Â© ä¸œä¸œ
    Modified copyright Â© 2026 æ¸…é¥
 -->
<!DOCTYPE html>
<html lang="en">
<% 
        const bloggerName =  subRoot.note.getLabelValue("bloggerName") ;
        const siteName =  subRoot.note.getLabelValue("siteName") ;
        const siteDescription =  note.getLabelValue("summary") ;
        const bloggerAvatar = (subRoot.note.hasLabel("bloggerAvatarLink") && subRoot.note.getLabelValue("bloggerAvatarLink").trim() !== '') ? subRoot.note.getLabelValue("bloggerAvatarLink") : `api/images/${subRoot.note.getRelation("bloggerAvatar").value}/åšä¸»å¤´åƒ`;
        const homepageBG = (subRoot.note.hasLabel("homepageBGLink") && subRoot.note.getLabelValue("homepageBGLink").trim() !== '') ? subRoot.note.getLabelValue("homepageBGLink") : `api/images/${subRoot.note.getRelation("homepageBG").value}/ä¸»é¡µèƒŒæ™¯`;
        
        function getDaysAgo(dateStr) {
          const date = new Date(dateStr);
          const currentDate = new Date();
          const delta = currentDate - date;
          const days = Math.floor(delta / (1000 * 60 * 60 * 24));
    
          if (days <= 0) {return "ä»Šå¤©";
          } else if (days === 1) {return "æ˜¨å¤©";
          } else if (days === 2) {return "å‰å¤©";
          } else if (days < 7) {return `${days}å¤©å‰`;
          } else if (days < 30) {const weeks = Math.floor(days / 7);return `${weeks}å‘¨å‰`;
          } else if (days <365) {const months = Math.floor(days /30);return `${months}ä¸ªæœˆå‰`;
          } else{const years = Math.floor(days/365);return `${years}å¹´å‰`;}
        }
        %>

<head>
  <meta charset="UTF-8">
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><%= note.hasLabel("timeLineRoot") ? `${siteName}` : `${note.title} - ${siteName}` %></title>
  <meta name="keywords" content="<%= subRoot.note.getLabelValue("siteKeywords") %>">
  <meta name="author" content="<%= bloggerName%>">
  <meta name="copyright" content="<%= bloggerName%>">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#5986D1">
  <meta name="description" content="<%= siteDescription %>">
  <link href="api/notes/<%= note.getRelation("prismCSS").value %>/download" rel="stylesheet">
  <script src="api/notes/<%= note.getRelation("qrCodeJS").value %>/download"></script>
  <script type="module" src="api/notes/<%= note.getRelation("prismJS").value %>/download"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.2/lunar.min.js"></script>
  <script src="https://unpkg.com/pinyin-pro"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.js"></script>
  <% if (note.hasRelation("shareFavicon")) { %>
  <link rel="shortcut icon" href="api/notes/<%= note.getRelation("shareFavicon").value %>/download">
  <% } else { %>
  <link rel="shortcut icon" href="../favicon.ico">
  <% } %>
  <% for (const cssRelation of note.getRelations("shareCss")) { %>
  <link href="api/notes/<%= cssRelation.value %>/download" rel="stylesheet">
  <% } %>
  <% for (const jsRelation of note.getRelations("shareJs")) { %>
  <script type="module" src="api/notes/<%= jsRelation.value %>/download"></script>
  <% } %>
  <% if (note.isLabelTruthy('shareDisallowRobotIndexing')) { %>
  <meta name="robots" content="noindex,follow" />
  <% } %>
  <%- header %>
  <script src="https://s4.zstatic.net/npm/twikoo@1.6.44/dist/twikoo.min.js"></script>
</head>

<%
    const headingRe = /(<h[1-6]\s*(?:[^>]+\s*)*>)(.+?)(<\/h[1-6]>)/g;
    const headingMatches = [...content.matchAll(headingRe)];
    const slugify = (text) => text.replace(/\s/g, " ");
    content = content.replaceAll(headingRe, (...match) => {
        const regex = /(<([^>]+)>)/ig;
        const tocTextContent = slugify(match[2]).replace(regex, '')
        match[0] = match[0].replace(match[3], `<a id="${tocTextContent}" class="toc-anchor" name="${tocTextContent}" href="#${tocTextContent}">â€»</a>${match[3]}`);
        return match[0];
    }).replaceAll(/class="language-text-x-(\w+)"/g , (...match) => {
        match[0] = match[0].replace("-text-x", "");
        return match[0];
    }).replaceAll( /class="language-text-(\w+)"/g , (...match) => {
        match[0] = match[0].replace("-text", "");
        return match[0];
    }).replaceAll( /class="language-application-x-(\w+)"/g , (...match) => {
        match[0] = match[0].replace("-application-x", "");
        return match[0];
    }).replaceAll( /class="language-application-(\w+)"/g , (...match) => {
        match[0] = match[0].replace("-application", "");
        return match[0];
    }).replaceAll("language-application-javascript-env-backend" , "language-javascript").replaceAll("language-application-javascript-env-frontend" , "language-javascript");
    %>

<body data-note-id="<%= note.noteId %>" data-ancestor-note-id="<%= subRoot.note.getVisibleChildNotes()[5].noteId %>">
  <div id="mobileMenuContainer"></div>
  <div id="globalBackground"><img id="globalBackgroundImg" src=<%= homepageBG %> style="position: fixed;margin-left: auto;margin-right: auto;display: flex;-o-object-fit: cover;object-fit: cover;" width="auto" height="100%">
    <div class="overlay"></div>
  </div>
  <div id="navigationBar" class="scroll-hide">
    <div id="siteTitle">
      <img src="api/images/<%= subRoot.note.getRelation("shareFavicon").value %>/logo.svg" alt="Logo" />
      <a href="./" title="è¿”å›ä¸»é¡µ"><%= siteName %></a>
    </div>
    <div id="navigationItems">
      <div class="navigationItemsStyle">
        <a href="./" title="é¦–é¡µ" class="menuLinkStyle">é¦–é¡µ</a>
      </div>
      <div class="navigationItemsStyle">
        <a href="./recentActivity" title="æµè§ˆå…¨éƒ¨è¯´è¯´" class="menuLinkStyle">è¯´è¯´</a>
      </div>
      <!--<div class="navigationItemsStyle">
        <a id="category" title="åˆ†ç±»" class="menuLinkStyle">åˆ†ç±»<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="
        width: 10px;
        height: 10px;
        margin-left: 2px;
    ">
            <path d="M3 8L12 17L21 8"></path>
          </svg></a>
        <div id="categoryDropDown" class="dropDownStyle">
          <% subRoot.note.getVisibleChildNotes()[1].getVisibleChildNotes().forEach((childNote)=> { %>
          <a href="<%= childNote.shareId %>" title="<%= childNote.title %>" style="display: flex;justify-content: flex-start;align-items: center;" class="menuLinkStyle"><%= childNote.title %>
            <div id="articleCount"><%= childNote.getVisibleChildNotes().length %></div>
          </a>
          <% })%>
        </div>
      </div>-->

      <% subRoot.note.getVisibleChildNotes()[3].getVisibleChildNotes().forEach((childNote) =>{ %>
      <div class="navigationItemsStyle">
        <% if (childNote.hasVisibleChildren()){ %>
        <a title="<%=childNote.title%>" class="menuLinkStyle"><%=childNote.title%><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="width: 10px; height: 10px; margin-left: 2px;">
            <path d="M3 8L12 17L21 8"></path>
          </svg></a>
        <div class="dropDownStyle">
          <% childNote.getVisibleChildNotes().forEach((subOption)=>{ %>
          <% if (subOption.hasLabel("shareExternalLink")) {%>
          <a href="<%=subOption.getLabelValue("shareExternalLink")%>" title="<%=subOption.title%>" class="menuLinkStyle" target="_blank" rel="noopener"><%=subOption.title%></a>
          <%}else {%>
          <a href="<%=subOption.shareId%>" title="<%=subOption.title%>" class="menuLinkStyle"><%=subOption.title%></a>
          <%}}) %>
        </div>
        <%}else{%>
        <% if (childNote.hasLabel("shareExternalLink")) {%>
        <a href="<%=childNote.getLabelValue("shareExternalLink")%>" title="<%=childNote.title%>" class="menuLinkStyle" target="_blank" rel="noopener"><%=childNote.title%></a>
        <%}else{%>
        <a href="<%=childNote.shareId%>" title="<%=childNote.title%>" class="menuLinkStyle"><%=childNote.title%></a>
        <%}}%>
      </div>
      <%})%>
      <div class="navigationItemsStyle">
        <div id="searchButton" class="navigationItemsStyle menuLinkStyle" style="margin:0px;cursor: pointer;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </div>
      </div>
      <div id="toggleMenuButton"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg></div>
    </div>
  </div>
  <div style="display: flex;justify-content: center;">
    <div id="searchContainer" class="searchContainerStyle">
      <input type="text" id="searchInput" placeholder="è¯·è¾“å…¥æŸ¥è¯¢å†…å®¹...">
      <div id="searchResults"></div>
    </div>
  </div>
  <div id="layout">
    <div id="main">
      <h1 id="title"><%= note.title %></h1>
      <% if (note.hasLabel("date") && note.getLabelValue('date')!=null) { %>
      <div id="contentHeader">
        <div class="blogMetadate">
          <% const tags = note.getLabelValues("tags");
                          if (tags!=null ||tags!=undefined ||tags!=""){
                              tags.forEach((tag)=>{ %>
          <a href="./tag_<%= tag %>">
            <div class="blogMetadateItems categoryBadge shakeStyle">
              <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
              <div style="margin-left: 0.3rem;"><%= tag  %></div>
            </div>
          </a>
          <%})} %>
        </div>
        <div style="display: flex;margin-left: 1em;">
          <% if (subRoot.note.hasLabel("enableVisitors")) { %>
          <div class="blogMetadate" title="é˜…è¯»é‡">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" str-linecap="round" stroke-linejoin="round" class="feather feather-eye">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <span id="twikoo_visitors" style="padding-left: 0.3em;">-</span>
          </div>
          <% } %>

          <div class="blogMetadate" title="æœ¬æ–‡å­—æ•°">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span id="articleWordCount" style="padding-left: 0.3em;">-</span>
            <span>å­—</span>
          </div>
          <div class="blogMetadate" title="å‘è¡¨æ—¥æœŸ">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg></span>
            <span style="padding-left: 0.3em;"><%= note.getLabelValue("date").split("T")[0] + ' ' + note.getLabelValue("date").split("T")[1]%>
          </div>
        </div>
      </div>
      <% } %>
      <% if (note.hasLabel("pageUrl")) { %>
      <div id="noteClippedFrom">This note was originally clipped from <a href="<%= note.getLabelValue("pageUrl") %>"><%= note.getLabelValue("pageUrl") %></a></div>
      <% } %>

      <% if (!isEmpty) { %>
      <% if (note.getLabelValue("categoryName") === "å‹é“¾") { %>
      <div class="fLinkContainer">
        <% const fLnksDate = content.replace(/<\/?pre>/g, '').replace(/[\n\s]/g, "");const fLinks = JSON.parse(fLnksDate); 
            for (let key in fLinks) {%>
        <a class="fLink cf-friends-link" href="<%= fLinks[key]['link'] %>" target="_blank" rel="noopener">
          <img class="cf-friends-avatar" src="<%= fLinks[key]['img'] %>" alt="<%= fLinks[key]['title'] %>">
          <div id="fLinkTitle" class="cf-friends-name"><%= fLinks[key]['title'] %></div>
          <div id="fLinkDes"><%= fLinks[key]['des'] %></div>
        </a>
        <% }%>
      </div>
      <div>
        <hr>
        <blockquote>
          <p>å£°æ˜ï¼š<%= note.getLabelValue("notes") %>
          </p>
        </blockquote>
        <p>æˆ‘çš„å‹é“¾ï¼š</p>
        <pre><code class="language-json">"title": "<%= note.getLabelValue("myTitle") %>",
"link": "<%= note.getLabelValue("myLink") %>",
"img": "<%= note.getLabelValue("myImg") %>",
"des": "<%= note.getLabelValue("myDes") %>"</code></pre>
        <p>åŠ å…¥æœ¬ç«™å‹é“¾çš„æ ¼å¼ï¼š</p>
        <pre><code class="language-json">{
    "title": "åšå®¢åç§°",  //å»ºè®®8ä¸ªä¸­æ–‡å­—ç¬¦ä»¥å†…
    "link": "åšå®¢é“¾æ¥",
    "img": "ç«™é•¿å¤´åƒ",
    "des": "åšå®¢æè¿°"
}</code></pre>
      </div>
      <% } else if (note.getLabelValue("categoryName") === "æœ‹å‹åœˆ")  {%>
      <div id="hexo-circle-of-friends-root"></div>
      <script>
        let UserConfig = {
          private_api_url: '<%=note.getLabelValue("friendCircleUrl")%>',
          page_init_number: 20,
          page_turning_number: 10,
          error_img: 'https://sdn.geekzu.org/avatar/57d8260dfb55501c37dde588e7c3852c',
          sort_rule: 'created',
          expire_days: 1,
        }
      </script>
      <script type="text/javascript" src="https://npm.elemecdn.com/fcircle-theme-yyyz@1.0.13/dist/fcircle.min.js"></script>
      <% } else if (note.getLabelValue("categoryName") === "ç°åœ¨")  {%>
      <div id="content" class="type-<%= note.type %><% if (note.type === 'text') { %> ck-content<% } %>">
        <%- content %>
      </div>
      <%- include('now') %>
      <% } else if (note.getLabelValue("categoryName") === "å½’æ¡£")  {%>
      <div style="display: block; margin: 0 auto; width: fit-content;">
        <input type="checkbox" id="toggleSummary" class="toggle-checkbox" checked>

        <label for="toggleSummary" class="toggle-label">
          <span class="toggle-track">
            <span class="toggle-dot"></span>
          </span>
          <span id="toggleText" class="toggle-text">æ˜¾ç¤ºæ‘˜è¦</span>
        </label>
      </div>
      <% const groupedNotes = Object.fromEntries(
                 Object.entries(
                   subRoot.note.getVisibleChildNotes()[5].getVisibleChildNotes().reduce((groupedNotes, note) => {
                     const year = note.getLabelValue('date').slice(0, 4);
                     if (!groupedNotes[year]) {
                       groupedNotes[year] = [];
                     }
                     const index = groupedNotes[year].findIndex(n => n.date < note.getLabelValue('date'));
                     if (index === -1) {
                       groupedNotes[year].push({ date: note.getLabelValue('date'), title: note.title, link: note.hasLabel('shareAlias') ? note.getLabelValue('shareAlias') : note.noteId, summary: note.getLabelValue("summary")});
                     } else {
                       groupedNotes[year].splice(index, 0, { date: note.getLabelValue('date'), title: note.title, link: note.hasLabel('shareAlias') ? note.getLabelValue('shareAlias') : note.noteId, summary: note.getLabelValue("summary")});
                     }
                     return groupedNotes;
                   }, {})
                 )
               )
               const postYears = Object.keys(groupedNotes).sort((a, b) => b - a);
                   
             %>
      <div id="content" class="timeline">
        <% postYears.forEach(postYear =>{ %>
        <div class="year">
          <span class="yearLabel"><%=postYear%></span>
          <% groupedNotes[postYear].forEach(item => { %>
          <div class="post">
            <div class="postDate"><%= item.date.slice(5,10) %></div>
            <div class="post-content">
              <a class="postTitle" href="./<%= item.link %>"><%= item.title %></a>
              <div class="summary" style="font-size:90%;font-weight: 400;margin-top:5px; display: none"><%= item.summary %></div>
            </div>
          </div>
          <%})%>
        </div>
        <%})%>

      </div>
      <% } else if (note.getLabelValue("categoryName") === "æ ‡ç­¾äº‘")  {%>
      <% 
             function getRandomColor() {
                 const letters = '0123456789ABCDEF';
                 let color = '#';
                 for (let i = 0; i < 6; i++) {
                     color += letters[Math.floor(Math.random() * 16)];
                 }
                 return color + 'A6';
             }
           %>
      <div class="tagCloud">
        <% subRoot.note.getVisibleChildNotes()[4].getVisibleChildNotes().forEach( tags => { 
          %>
        <a class="tagItem" style="background-color: <%= getRandomColor() %>;" href="./tag_<%= tags.title %>"><%=`${tags.title}(${tags.getVisibleChildNotes().length})`%></a>
        <% }) %>
      </div>
      <% } else{%>
      <div id="content" class="type-<%= note.type %><% if (note.type === 'text') { %> ck-content<% } %>">
        <%- content %>
      </div>
      <% } %>

      <div id="rewardContainer">
        <% if (note.hasLabel("showShare")) { %>
        <button id="shareBtn">ğŸ”—åˆ†äº«</button>
        <p style="font-size: smaller; display: none;" class="coffee" id="shareTips">â€œé“¾æ¥å·²å¤åˆ¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç›´æ¥æ‰«æä¸‹æ–¹äºŒç»´ç æ‰“å¼€å½“å‰é¡µé¢â€</p>
        <div id="qrCodeContainer">
          <p id="qrCodeTips"></p>
          <div id="qrCode" class="rewardImg">
          </div>
        </div>
        <% } %>
        <% if (subRoot.note.hasLabel("enableReward") && note.hasLabel("showReward")) { %>
        <button id="rewardBtn">ğŸ”‹å……ç”µ</button>
        <p style="font-size: smaller;" class="coffee">â€œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æŒç»­åˆ†äº«çš„åŠ¨åŠ›â€</p>
        <div id="rewardImgContainer">
          <div>
            <img class="rewardImg" src="api/images/<%= subRoot.note.getRelation("wechatPay").value %>/å¾®ä¿¡æ”¶æ¬¾ç " alt="å¾®ä¿¡æ”¶æ¬¾ç " />
            <div class="wechatPay">å¾®ä¿¡</div>
          </div>
          <div>
            <img class="rewardImg" src="api/images/<%= subRoot.note.getRelation("aliPay").value %>/æ”¯ä»˜å®æ”¶æ¬¾ç " alt="æ”¯ä»˜å®æ”¶æ¬¾ç " />
            <div class="aliPay">æ”¯ä»˜å®</div>
          </div>
        </div>
        <% } %>
      </div>
      <% } %>
      <hr>

      <% if (note.hasVisibleChildren()) { %>
      <% if (note.getLabelValue("categoryName") === "é¦–é¡µ") { %>
      <div class="tag-system container">
        <div class="tags-container">
          <h2 class="tags-title">å…¨éƒ¨æ ‡ç­¾</h2>
          <div id="tagGroupsContainer">
            <div class="loading">
              <i class="fa fa-spinner fa-spin"></i>
              <p>åŠ è½½æ ‡ç­¾ä¸­...</p>
            </div>
          </div>
        </div>
        <div class="nav-container">
          <h2 class="nav-title">åˆ†ç»„å¯¼èˆª</h2>
          <div class="nav-buttons">
            <button class="letter-nav-btn active" data-letter="all">
              å…¨éƒ¨
            </button>
          </div>
        </div>
        <div class="search-container">
          <h2 class="tags-title">æœç´¢</h2>
          <div class="search-wrapper">
            <i class="fa fa-search search-icon"></i>
            <input type="text" id="tagSearch" placeholder="è¾“å…¥å…³é”®è¯æœç´¢æ ‡ç­¾..." />
          </div>
          <div class="search-info">
            <p id="searchResult">
              <i class="fa fa-info-circle"></i>å…± <span class="primary">0</span> ä¸ªæ ‡ç­¾
            </p>
            <button id="clearSearch">
              <i class="fa fa-times"></i>æ¸…é™¤æœç´¢
            </button>
          </div>
        </div>

      </div>

      <script>
        function initTagSystem() {
          const searchInput = document.getElementById('tagSearch');
          const clearBtn = document.getElementById('clearSearch');
          const groupsContainer = document.getElementById('tagGroupsContainer');
          const resultText = document.getElementById('searchResult');
          const totalTagsEl = resultText.querySelector('span');
          const navContainer = document.querySelector('.nav-buttons');
          const tagsTitleEl = document.querySelector('.tags-title');
          const allNavBtn = navContainer.querySelector('[data-letter="all"]');
          const originalTags = [
            <% 
      const tagList = subRoot.note.getVisibleChildNotes()[4].getVisibleChildNotes();
      tagList.forEach((tags, index) => { 
        const tagName = tags.title.replace(/"/g, '\\"');
        const tagUrl = `./tag_${tags.title}`.replace(/"/g, '\\"');
        const tagSize = tags.getVisibleChildNotes().length;
    %> {
              name: "<%= tagName %>",
              url: "<%= tagUrl %>",
              size: "<%= tagSize %>"
            }
            <%= index < tagList.length - 1 ? ',' : '' %>
            <% }) %>
          ];
          let currentLetter = 'all';
          let currentKeyword = '';

          function getFirstLetter(tagName) {
            try {
              const firstChar = tagName.charAt(0);
              if (/^[A-Za-z]$/.test(firstChar)) {
                return firstChar.toUpperCase();
              }

              const pinyin = pinyinPro.pinyin(firstChar, {
                pattern: 'first',
                toneType: 'none',
                nonZh: 'removed'
              });
              return pinyin.toUpperCase() || '#';
            } catch (e) {
              return firstChar.toUpperCase() || '#';
            }
          }

          function groupAndSortTags(tags) {
            const groups = {};
            tags.forEach(tag => {
              const letter = getFirstLetter(tag.name);
              if (!groups[letter]) {
                groups[letter] = [];
              }
              groups[letter].push({
                ...tag
              });
            });
            Object.keys(groups).forEach(letter => {
              groups[letter].sort((a, b) => {
                const aPinyin = pinyinPro.pinyin(a.name, {
                  pattern: 'full',
                  toneType: 'none',
                  nonZh: 'removed'
                });
                const bPinyin = pinyinPro.pinyin(b.name, {
                  pattern: 'full',
                  toneType: 'none',
                  nonZh: 'removed'
                });
                return aPinyin.localeCompare(bPinyin);
              });
            });
            const sortedLetters = Object.keys(groups).sort((a, b) => {
              if (a === '#') return 1;
              if (b === '#') return -1;
              return a.localeCompare(b);
            });

            return {
              groups,
              sortedLetters
            };
          }

          function renderLetterNav(letters) {
            navContainer.innerHTML = '';
            navContainer.appendChild(allNavBtn);

            letters.forEach(letter => {
              const btn = document.createElement('button');
              btn.className = 'letter-nav-btn';
              btn.textContent = letter;
              btn.dataset.letter = letter;

              btn.addEventListener('click', () => {
                if (!currentKeyword) {
                  currentLetter = letter;
                  tagsTitleEl.textContent = `${letter}`;
                  renderTagGroups(groups, sortedLetters, currentLetter, currentKeyword);
                  const group = document.getElementById(`tag-group-${letter}`);
                  resetNavActive(btn);
                }
              });

              navContainer.appendChild(btn);
            });
            allNavBtn.addEventListener('click', () => {
              currentLetter = 'all';
              tagsTitleEl.textContent = 'å…¨éƒ¨æ ‡ç­¾';
              renderTagGroups(groups, sortedLetters, 'all', currentKeyword);
              groupsContainer.scrollTop = 0;
              resetNavActive(allNavBtn);
            });
          }

          function resetNavActive(targetBtn) {
            document.querySelectorAll('.letter-nav-btn').forEach(btn => {
              btn.classList.remove('active');
            });
            targetBtn.classList.add('active');
          }

          function renderTagGroups(groups, sortedLetters, currentLetter, filterKeyword = '') {
            groupsContainer.innerHTML = '';
            let totalVisibleTags = 0;
            const allVisibleTags = [];

            sortedLetters.forEach(letter => {
              const groupTags = groups[letter];
              const visibleTags = filterKeyword ?
                groupTags.filter(tag => tag.name.toLowerCase().includes(filterKeyword.toLowerCase())) :
                groupTags;

              if (visibleTags.length === 0) return;

              totalVisibleTags += visibleTags.length;
              allVisibleTags.push(...visibleTags);
            });

            if (currentLetter === 'all') {
              if (allVisibleTags.length === 0) {
                groupsContainer.innerHTML = `
                        <div class="no-result">
                            <i class="fa fa-search"></i>
                            <p>æ²¡æœ‰æ‰¾åˆ°åŒ…å«"${filterKeyword}"çš„æ ‡ç­¾</p>
                        </div>
                    `;
                return;
              }

              const tagsEl = document.createElement('div');
              tagsEl.className = 'tags-list all-mode';

              allVisibleTags.sort((a, b) => {
                const aPinyin = pinyinPro.pinyin(a.name, {
                  pattern: 'full',
                  toneType: 'none',
                  nonZh: 'removed'
                });
                const bPinyin = pinyinPro.pinyin(b.name, {
                  pattern: 'full',
                  toneType: 'none',
                  nonZh: 'removed'
                });
                return aPinyin.localeCompare(bPinyin);
              });

              allVisibleTags.forEach(tag => {
                const tagEl = createTagElement(tag, filterKeyword);
                tagsEl.appendChild(tagEl);
              });

              groupsContainer.appendChild(tagsEl);
            } else {
              const groupTags = groups[currentLetter] || [];
              const visibleTags = filterKeyword ?
                groupTags.filter(tag => tag.name.toLowerCase().includes(filterKeyword.toLowerCase())) :
                groupTags;

              if (visibleTags.length === 0) {
                groupsContainer.innerHTML = `
                        <div class="no-result">
                            <i class="fa fa-search"></i>
                            <p>æ²¡æœ‰æ‰¾åˆ°åŒ…å«"${filterKeyword}"ä¸”ä»¥"${currentLetter}"å¼€å¤´çš„æ ‡ç­¾</p>
                        </div>
                    `;
                return;
              }

              const groupEl = document.createElement('div');
              groupEl.id = `tag-group-${currentLetter}`;
              groupEl.className = 'letter-group';

              const tagsEl = document.createElement('div');
              tagsEl.className = 'tags-list';

              visibleTags.forEach(tag => {
                const tagEl = createTagElement(tag, filterKeyword);
                tagsEl.appendChild(tagEl);
              });

              groupEl.appendChild(tagsEl);
              groupsContainer.appendChild(groupEl);
            }

            totalTagsEl.textContent = originalTags.length;
            if (filterKeyword) {
              resultText.innerHTML = `<i class="fa fa-search"></i>æ‰¾åˆ° <span class="primary">${totalVisibleTags}</span> ä¸ªæ ‡ç­¾`;
              clearBtn.style.display = 'inline-block';
            } else {
              resultText.innerHTML = `<i class="fa fa-info-circle"></i>å…± <span class="primary">${originalTags.length}</span> ä¸ªæ ‡ç­¾`;
              clearBtn.style.display = 'none';
            }
          }

          function escapeRegExp(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          }

          function createTagElement(tag, filterKeyword) {
            const tagEl = document.createElement('a');
            tagEl.href = tag.url;
            tagEl.title = `æŸ¥çœ‹ "${tag.name}" ç›¸å…³å†…å®¹`;
            tagEl.className = 'tag';

            tagEl.addEventListener('mousedown', () => tagEl.classList.add('tag-active'));
            tagEl.addEventListener('mouseup', () => tagEl.classList.remove('tag-active'));
            tagEl.addEventListener('mouseleave', () => tagEl.classList.remove('tag-active'));
            tagEl.addEventListener('touchstart', () => tagEl.classList.add('tag-active'));
            tagEl.addEventListener('touchend', () => tagEl.classList.remove('tag-active'));

            if (filterKeyword) {
              const escapedKeyword = escapeRegExp(filterKeyword);
              const highlightedName = tag.name.replace(
                new RegExp(escapedKeyword, 'gi'),
                match => `<span class="highlight">${match}</span>`
              );
              tagEl.innerHTML = `${highlightedName}(${tag.size})`;
            } else {
              tagEl.textContent = `${tag.name}(${tag.size})`;
            }

            return tagEl;
          }

          const {
            groups,
            sortedLetters
          } = groupAndSortTags(originalTags);
          renderLetterNav(sortedLetters);
          renderTagGroups(groups, sortedLetters, 'all', '');

          searchInput.addEventListener('input', (e) => {
            currentKeyword = e.target.value.trim();

            if (currentKeyword) {
              currentLetter = 'all';
              tagsTitleEl.textContent = 'å…¨éƒ¨æ ‡ç­¾';
              resetNavActive(allNavBtn);
            }

            renderTagGroups(groups, sortedLetters, currentLetter, currentKeyword);
          });

          clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            currentKeyword = '';
            currentLetter = 'all';
            tagsTitleEl.textContent = 'å…¨éƒ¨æ ‡ç­¾';
            resetNavActive(allNavBtn);
            renderTagGroups(groups, sortedLetters, currentLetter, '');
          });
        }
        window.addEventListener('DOMContentLoaded', initTagSystem);
      </script>
      <% } %>
      <nav id="childLinks" class="<% if (isEmpty) { %>grid<% } else { %>list<% } %>">
        <% if (!isEmpty) { %>
        <hr>
        <% } %>
        <% const childNotes = note.getLabelValue("categoryName")==="é¦–é¡µ" ? note.getVisibleChildNotes().slice(0, 5) :  note.getVisibleChildNotes();
                    for (const childNote of childNotes) {
                        const isExternalLink = childNote.hasLabel('shareExternalLink');
                        const linkHref = isExternalLink ? childNote.getLabelValue('shareExternalLink') : `./${childNote.shareId}`;
                        const target = isExternalLink ? `target="_blank" rel="noopener noreferrer"` : '';
                    %>
        <div id="blogItems" style="<%= childNote.hasLabel("blogPostTop") ? 'order: -1' : ''%>">
          <div class="blogItemsMainContain">
            <a style="color: black;" href="<%= linkHref %>" <%= target %> class="type-<%= childNote.type %>">
              <div>
                <% if (childNote.hasLabel("blogPostTop")) { %>
                <b class="blogPostTopStyle">ğŸ“Œç½®é¡¶</b>
                <% } %>
                <b id="blogItemTitle"><%= childNote.title %></b>
              </div>
              <div>
                <% if (childNote.hasLabel("headerImage") && childNote.getLabelValue("headerImage")!=null) { %>
                <div id="blogItemSummaryImgContain">
                  <img src="<%= childNote.getLabelValue("headerImage") %>">
                </div>

                <% } %>
                <% if (childNote.hasLabel("summary") && childNote.getLabelValue("summary")!=null) { %>
                <div id="blogItemSummary" style="font-size:90%;font-weight: 400;margin-top:5px;"><%= childNote.getLabelValue("summary") %></div>
                <% } %>
              </div>
            </a>
            <div class="blogMetadate">
              <% const tags = childNote.getLabelValues("tags");
                              if (tags!=null ||tags!=undefined ||tags!=""){
                                  tags.forEach((tag)=>{ %>
              <a href="./tag_<%= tag %>">
                <div class="blogMetadateItems categoryBadge shakeStyle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                  </svg>
                  <div style="margin-left: 0.3rem;"><%= tag  %></div>
                </div>
              </a>
              <%})} %>
              <!--<a href="./category_<%= childNote.getLabelValue("category") %>">
                <div class="blogMetadateItems categoryBadge shakeStyle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                  </svg>
                  <div style="margin-left: 0.3rem;"><%= childNote.getLabelValue("category")  %></div>
                </div>
              </a>-->

              <% if (childNote.hasLabel("date") && childNote.getLabelValue("date")!=null) { 
                            const postDate = childNote.getLabelValue("date");
                            %>
              <div class="blogMetadateItems">
                <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <div id="blogPostDate" style="margin-left: 0.3rem;" blogpostdate="<%= postDate %>"><%= getDaysAgo(postDate.split("T")[0])%></div>
              </div>
              <% } %>
            </div>
          </div>
        </div>
        <% } %>
      </nav>
      <% if(note.getLabelValue("categoryName")==="é¦–é¡µ"){  headingMatches.length = 0; %>

      <div id="morePost">
        <div> =&nbspç‚¹å‡»&nbsp</div>
        <a href="./timeline">å½’æ¡£</a>
        <div> &nbspæŸ¥çœ‹æ›´å¤šå†…å®¹&nbsp= </div>
      </div>
      <% } %>
      <% } else if (isEmpty) { %>
      <p>æ–½å·¥ä¸­...</p>
      <% } %>

      <% if (subRoot.note.hasLabel("enableTwikoo")) { %>
      <div style="display:<%= note.hasLabel("showComments")?"block":"none" %> !important">
        <div id="tcomment"></div>
      </div>
      <script>
        twikoo.init({
          envId: "<%= subRoot.note.getLabelValue("envId") %>",
          el: '#tcomment',
        })
      </script>
      <% } %>
      <div id="onTop" title="å‰å¾€é¡¶éƒ¨">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up" style="
       color: #ffffff;
   ">
          <line x1="12" y1="19" x2="12" y2="5"></line>
          <polyline points="5 12 12 5 19 12"></polyline>
        </svg>
      </div>
    </div>
    <div id="menuCard" class="cardContainerStyle" style="<%=subRoot.note.hasLabel("swapInfoCard")?"right:10px":"left:10px"%>">

      <%# æ—¥å† #%>
      <% if (subRoot.note.hasLabel("enableCalendar") && (subRoot.note.getLabelValue("enableCalendar") === "true")) { %>
      <div class="bloggerInfoCardStyle" style="margin-left: auto;">
        <p style="color:black">
        <div id="year" class="bloggerInfoTitleStyle"></div>
        </p>
        <hr>
        <div>
          <div id="date" style="font-size:1.5em"></div>
          <div id="holiday"></div>
          <div id="lunar"></div>
        </div>
      </div>
      <% } %>

      <%# éšæœºè¯—è¯ #%>
      <% if (subRoot.note.hasLabel("enableRandomPoetry") && (subRoot.note.getLabelValue("enableRandomPoetry") === "true")) { %>
      <div class="bloggerInfoCardStyle" style="margin-left: auto;">
        <p style="color:black">
        <div class="bloggerInfoTitleStyle">éšæœºè¯—è¯</div>
        </p>
        <hr>
        <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        <div id="poem_sentence"></div>
        <div id="poem_info"></div>
        <script type="text/javascript">
          jinrishici.load(function(result) {
            var sentence = document.querySelector("#poem_sentence")
            var info = document.querySelector("#poem_info")
            sentence.innerHTML = result.data.content
            info.innerHTML = 'ã€' + result.data.origin.dynasty + 'ã€‘' + result.data.origin.author + 'ã€Š' + result.data.origin.title + 'ã€‹'
          });
        </script>
      </div>
      <% } %>

      <%# è¯´è¯´ #%>
      <% 
        // å…ˆè·å–å¹¶ç¼“å­˜è¯´è¯´æ•°æ®ï¼Œæ–¹ä¾¿åç»­åˆ¤æ–­
        const top5Notes = subRoot.note.getVisibleChildNotes()[0].getVisibleChildNotes().slice(0,5);
        const hasPersonalDynamic = top5Notes.length > 0;
      %>
      <% if(subRoot.note.hasLabel("enablePersonalDynamic") && hasPersonalDynamic) {%>
      <div id="recentActivityCard" class="bloggerInfoCardStyle" style="margin-left: auto;">
        <a href="./recentActivity" style="color:black" title="æµè§ˆå…¨éƒ¨è¯´è¯´">
          <div class="bloggerInfoTitleStyle">è¯´è¯´</div>
        </a>
        <hr>
        <% top5Notes.forEach((childNote)=>{%>
        <div class="cardItemLinkStyle">
          <b style="font-size: 0.6em;
        display: inline-block;
        width: 3.5em;
        text-align: center;"><%= getDaysAgo(childNote.getLabelValue("date").split("T")[0])%></b>
          <a href="./<%= childNote.shareId %>" title="<%=  childNote.title %>" class="menuLinkStyle"><%= childNote.title %></a>
        </div>
        <% }) %>
      </div>
      <% } %>

      <%# æ¨èé˜…è¯» #%>
      <% 
        // å…ˆè·å–å¹¶ç¼“å­˜æ¨èé˜…è¯»æ•°æ®ï¼Œæ–¹ä¾¿åç»­åˆ¤æ–­
        const recommendedReadingNotes = subRoot.note.getVisibleChildNotes()[2].getVisibleChildNotes();
        const hasRecommendedReadingNotes = recommendedReadingNotes.length > 0;
      %>
      <% if(subRoot.note.hasLabel("enableRecommendedReading") && hasRecommendedReadingNotes) {%>
      <div id="recommendedReadingCard" class="bloggerInfoCardStyle" style="margin-left: auto;">
        <a href="./recommendedReading" style="color:black" title="æµè§ˆå…¨éƒ¨æ¨è">
          <div class="bloggerInfoTitleStyle">æ¨èé˜…è¯»</div>
        </a>
        <hr>
        <% recommendedReadingNotes.forEach((childNote)=>{%>
        <div class="cardItemLinkStyle">
          <b style="font-size: 0.8rem;">ğŸ”¥</b>
          <a href="./<%= childNote.shareId %>" title="<%=  childNote.title %>" class="menuLinkStyle"><%= childNote.title %></a>
        </div>
        <% }) %>
      </div>
      <% } %>
    </div>
    <% if(note.getLabelValue("categoryName")==="å…³äº"){  headingMatches.length = 0; } %>
    <% if (headingMatches.length > 1){ %>
    <!-- ç›®å½•æ’ä»¶ -->
    <%
                const level = (m) => parseInt(m[1].replace(/[<h>]+/g, ""));
    
                const toc = [
                    {
                        level: level(headingMatches[0]),
                        name: headingMatches[0][2],
                        children: []
                    }
                ];
                const last = (arr = toc) => arr[arr.length - 1];
                const makeEntry = (m) => ({level: level(m), name: m[2], children: []});
                const getLevelArr = (lvl, arr = toc) => {
                    if (arr[0].level === lvl) return arr;
                    const top = last(arr);
                    return top.children.length ? getLevelArr(lvl, top.children) : top.children;
                };
    
    
                for (let m = 1; m < headingMatches.length; m++) {
                    const target = getLevelArr(level(headingMatches[m]));
                    target.push(makeEntry(headingMatches[m]));
                }
                %>
    <div id="toc-pane" style="<%=subRoot.note.hasLabel("swapInfoCard")?"left:10px":"right:10px"%>">
      <strong>ç›®å½•</strong>
      <ul id="toc">
        <% for (const entry of toc) { %>
        <%- include('toc_item', {entry}) %>
        <% } %>
      </ul>
    </div>

    <% }%>
    <div id="bloggerInfoCard" class="cardContainerStyle" style="<%=subRoot.note.hasLabel("swapInfoCard")?"left:10px":"right:10px"%>; display:<%=headingMatches.length > 1?"none":"block"  %>">
      <div id="bloggerInfo" class="bloggerInfoCardStyle">
        <a href="./about" title="å…³äºåšä¸»">
          <img src=<%= bloggerAvatar %> href="./about">
        </a>
        <div id="bloggerInfoName" class="bloggerInfoTitleStyle"><%= bloggerName%></div>
        <div id="motto" class="bloggerInfoContentStyle"><%= subRoot.note.getLabelValue("motto") %></div>
      </div>
      <%
       const linkLabels = [
         "githubLink",
         "RSSLink",  
         "zhihuLink",
         "sspaiLink",
         "netEaseCloudLink",
         "bilibiliLink",
         "doubanLink",
         "telegramLink", 
         "mailLink",
         "CSDNLink",
         "GiteeLink"
       ];
       const socialInformationExist =  linkLabels.some(element => {
         if (subRoot.note.hasLabel(element) && subRoot.note.getLabelValue(element).trim() !== ''){
           return true;
         }
       });
       %>
      <% if (socialInformationExist) {%>
      <div id="otherPlatformBar" class="bloggerInfoCardStyle">
        <% if (subRoot.note.hasLabel("githubLink") && subRoot.note.getLabelValue("githubLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="github" href="<%= subRoot.note.getLabelValue("githubLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>GitHub</title>
            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("RSSLink") && subRoot.note.getLabelValue("RSSLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="RSS" href="<%= subRoot.note.getLabelValue("RSSLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>RSS</title>
            <path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("zhihuLink") && subRoot.note.getLabelValue("zhihuLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="zhihu" href="<%= subRoot.note.getLabelValue("zhihuLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>çŸ¥ä¹</title>
            <path d="M5.721 0C2.251 0 0 2.25 0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75 0 18.281 0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104 0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223 0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("sspaiLink") && subRoot.note.getLabelValue("sspaiLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="sspai" href="<%= subRoot.note.getLabelValue("sspaiLink") %>"><svg data-v-b3f1de54="" data-v-fda2b58a="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" viewBox="0 0 36 36">
            <title>å°‘æ•°æ´¾</title>
            <path data-v-b3f1de54="" d="M18,0C8.1,0,0,8.1,0,18s8.1,18,18,18s18-8.1,18-18S27.9,0,18,0z M26.9,11.6c0,0.2-0.1,0.3-0.2,0.5
            c-0.1,0.1-0.3,0.2-0.4,0.2l-3.3,0.6v8.3c0,0.5,0.1,1,0.3,1.4l2.1,4c0.1,0.1,0.1,0.2,0.1,0.3c0,0.1,0,0.2-0.1,0.3
            c-0.1,0.1-0.1,0.2-0.3,0.2c-0.1,0.1-0.2,0.1-0.3,0.1H23c-0.1,0-0.3,0-0.4-0.1c-0.1-0.1-0.2-0.2-0.3-0.3l-2.1-3.9
            c-0.2-0.5-0.4-1-0.4-1.5v-8.4l-4.6,0.8v11.4c0,0.2,0,0.4-0.1,0.5c-0.1,0.2-0.2,0.3-0.4,0.4l-1.3,0.8c-0.1,0.1-0.3,0.1-0.4,0.1
            s-0.3,0-0.4-0.1c-0.1-0.1-0.2-0.2-0.3-0.3c-0.1-0.1-0.1-0.3-0.1-0.4v-12l-3.4,0.6c-0.1,0-0.2,0-0.4,0c-0.1,0-0.2-0.1-0.3-0.2
            C8.1,14.9,8,14.8,8,14.6c0-0.1-0.1-0.2,0-0.4l0.2-1.4c0-0.2,0.1-0.3,0.2-0.5c0.1-0.1,0.3-0.2,0.5-0.2l17.4-2.9c0.1,0,0.3,0,0.4,0
            c0.1,0,0.2,0.1,0.3,0.2C26.9,9.5,27,9.6,27,9.7c0,0.1,0.1,0.2,0,0.4L26.9,11.6z" class="logo"></path>
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("netEaseCloudLink") && subRoot.note.getLabelValue("netEaseCloudLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="netEaseCloud" href="<%= subRoot.note.getLabelValue("netEaseCloudLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>ç½‘æ˜“äº‘éŸ³ä¹</title>
            <path d="M13.046 9.388a3.919 3.919 0 0 0-.66.19c-.809.312-1.447.991-1.666 1.775a2.269 2.269 0 0 0-.074.81c.048.546.333 1.05.764 1.35a1.483 1.483 0 0 0 2.01-.286c.406-.531.355-1.183.24-1.636-.098-.387-.22-.816-.345-1.249a64.76 64.76 0 0 1-.269-.954zm-.82 10.07c-3.984 0-7.224-3.24-7.224-7.223 0-.98.226-3.02 1.884-4.822A7.188 7.188 0 0 1 9.502 5.6a.792.792 0 1 1 .587 1.472 5.619 5.619 0 0 0-2.795 2.462 5.538 5.538 0 0 0-.707 2.7 5.645 5.645 0 0 0 5.638 5.638c1.844 0 3.627-.953 4.542-2.428 1.042-1.68.772-3.931-.627-5.238a3.299 3.299 0 0 0-1.437-.777c.172.589.334 1.18.494 1.772.284 1.12.1 2.181-.519 2.989-.39.51-.956.888-1.592 1.064a3.038 3.038 0 0 1-2.58-.44 3.45 3.45 0 0 1-1.44-2.514c-.04-.467.002-.93.128-1.376.35-1.256 1.356-2.339 2.622-2.826a5.5 5.5 0 0 1 .823-.246l-.134-.505c-.37-1.371.25-2.579 1.547-3.007.329-.109.68-.145 1.025-.105.792.09 1.476.592 1.709 1.023.258.507-.096 1.153-.706 1.153a.788.788 0 0 1-.54-.213c-.088-.08-.163-.174-.259-.247a.825.825 0 0 0-.632-.166.807.807 0 0 0-.634.551c-.056.191-.031.406.02.595.07.256.159.597.217.82 1.11.098 2.162.54 2.97 1.296 1.974 1.844 2.35 4.886.892 7.233-1.197 1.93-3.509 3.177-5.889 3.177zM0 12c0 6.627 5.373 12 12 12s12-5.373 12-12S18.627 0 12 0 0 5.373 0 12Z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("bilibiliLink") && subRoot.note.getLabelValue("bilibiliLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="bilibili" href="<%= subRoot.note.getLabelValue("bilibiliLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>å“”å“©å“”å“©</title>
            <path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("doubanLink") && subRoot.note.getLabelValue("doubanLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="douban" href="<%= subRoot.note.getLabelValue("doubanLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>è±†ç“£</title>
            <path d="M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("telegramLink") && subRoot.note.getLabelValue("telegramLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="telegram" href="<%= subRoot.note.getLabelValue("telegramLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>Telegram</title>
            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("mailLink") && subRoot.note.getLabelValue("mailLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="mail" href="mailto:Email:<%= subRoot.note.getLabelValue("mailLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>é‚®ä»¶</title>
            <path d="M15.61 12c0 1.99-1.62 3.61-3.61 3.61-1.99 0-3.61-1.62-3.61-3.61 0-1.99 1.62-3.61 3.61-3.61 1.99 0 3.61 1.62 3.61 3.61M12 0C5.383 0 0 5.383 0 12s5.383 12 12 12c2.424 0 4.761-.722 6.76-2.087l.034-.024-1.617-1.879-.027.017A9.494 9.494 0 0 1 12 21.54c-5.26 0-9.54-4.28-9.54-9.54 0-5.26 4.28-9.54 9.54-9.54 5.26 0 9.54 4.28 9.54 9.54a9.63 9.63 0 0 1-.225 2.05c-.301 1.239-1.169 1.618-1.82 1.568-.654-.053-1.42-.52-1.426-1.661V12A6.076 6.076 0 0 0 12 5.93 6.076 6.076 0 0 0 5.93 12 6.076 6.076 0 0 0 12 18.07a6.02 6.02 0 0 0 4.3-1.792 3.9 3.9 0 0 0 3.32 1.805c.874 0 1.74-.292 2.437-.821.719-.547 1.256-1.336 1.553-2.285.047-.154.135-.504.135-.507l.002-.013c.175-.76.253-1.52.253-2.457 0-6.617-5.383-12-12-12" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("CSDNLink") && subRoot.note.getLabelValue("CSDNLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="csdn" href="<%= subRoot.note.getLabelValue("CSDNLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>CSDN</title>
            <path d="M5.721 0 C2.251 0 0 2.25 0 5.719 V18.28 C0 21.751 2.252 24 5.721 24 h12.56 C21.751 24 24 21.75 24 18.281 V5.72 C24 2.249 21.75 0 18.281 0 z m11.964 20.078 c -2.521127,1.148702 -7.021257,1.063026 -9.257157,-0.176244 -7.032096,-3.897592 -3.327532,-16.95337 4.810503,-16.95337 3.057134,0 6.050353,2.262707 5.362937,4.054083 -0.465835,1.21395 -0.617912,1.214611 -2.654548,0.01154 -4.185044,-2.472166 -7.901445,0.44038 -7.901445,6.190729 0,4.333447 4.53876,6.268816 8.384436,3.575199 0.917507,-0.642647 2.005103,-0.960229 2.416879,-0.705737 1.407412,0.869828 0.750992,3.132363 -1.161605,4.003801 z" />
          </svg>
        </a>
        <% } %>
        <% if (subRoot.note.hasLabel("GiteeLink") && subRoot.note.getLabelValue("GiteeLink")) { %>
        <a class="platformStyle" target="_blank" rel="noopener" title="gitee" href="<%= subRoot.note.getLabelValue("GiteeLink") %>"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>Gitee</title>
            <path d="M5.721 0 C2.251 0 0 2.25 0 5.719 V18.28 C0 21.751 2.252 24 5.721 24 h12.56 C21.751 24 24 21.75 24 18.281 V5.72 C24 2.249 21.75 0 18.281 0 z m14.304,9.979 c0.84,0 1.204,0.347 1.204,0.743 l0,3.942 c0,2.885 -2.597,5.482 -5.482,5.482 l-11.28,0 c-0.396,0 -0.743,-0.347 -0.743,-0.743 l0,-10.784 c0,-2.885 2.597,-5.482 5.482,-5.482 l10.784,0 c0.396,0 0.742,0.347 0.742,0.743 l-0.001,2.199 c0,0.396 -0.347,0.743 -0.743,0.743 l-10.784,0 c-1.085,0 -2.072,0.905 -2.071,1.993 l0.001,7.193 c0,0.397 0.347,0.744 0.743,0.744 l7.188,0 c1.254,0 2.358,-1.004 2.358,-2.26 l0,-0.182 l0,0 l0,-0.182 c0,0 0,0 0,0 c0,-0.397 -0.347,-0.744 -0.744,-0.744 l-5.367,0 c0,0.001 0,0 0,0 c-0.397,0 -0.744,-0.354 -0.744,-0.747 l0.003,-1.911 c0,-0.396 0.347,-0.743 0.743,-0.743 l8.682,0 z" />
          </svg>
        </a>
        <% } %>
      </div>
      <% } %>
      <% if (subRoot.note.getLabelValue("announcement")) { %>
      <div id="announcement" class="bloggerInfoCardStyle">
        <div class="bloggerInfoTitleStyle">å…¬å‘Š</div>
        <hr>
        <div style="text-align: left;text-indent: 1em;" class="bloggerInfoContentStyle"><%= subRoot.note.getLabelValue("announcement") %></div>
      </div>
      <% } %>

      <% if(subRoot.note.hasLabel("enableTwikoo") && !subRoot.note.hasLabel("disableLatestCommentPane")) {%>
      <div id="latestCommentCard" class="bloggerInfoCardStyle">
        <div class="bloggerInfoTitleStyle">æœ€æ–°è¯„è®º</div>
        <hr>
        <div id="latestComment" class="cardItemLinkStyle" style="font-size: 13px;">åŠ è½½ä¸­...</div>
        <script>
          twikoo.getRecentComments({
            envId: "<%= subRoot.note.getLabelValue("envId") %>",
            urls: [],
            pageSize: 6,
            includeReply: false
          }).then(function(res) {
            const latestCommentCard = document.getElementById("latestCommentCard");
            if (res.length === 0) {
              latestCommentCard.style.display = "none";
            } else {
              latestCommentCard.style.display = "block";
              let latestComment = document.querySelector('#latestComment');
              latestComment.innerText = "";
              res.forEach((comment) => {
                let link = document.createElement('a');
                link.href = comment.url;
                link.title = comment.commentText;
                link.className = 'menuLinkStyle';
                let content = comment.commentText.replace(/[\r\n\s]+/g, "");
                link.innerText = `${comment.nick}: ${content}`;
                latestComment.appendChild(link);
              });
            }
          })
        </script>
      </div>
      <%}%>
        </div>
    
      </div>
      </div>
      <div id="footer">
        <hr>
        <div>
          <div>
            <% if (subRoot.note.getLabelValue("showDetailTime") === "true") { %>
      <span id="runTime">æœ¬ç«™å·²ç¨³å®šè¿è¡Œï¼š</span>
      <script>
        const startTimeStr = "<%=subRoot.note.getLabelValue("blogStartTime")%>";
        const dateTime = new Date(startTimeStr);
        const startTime = Math.floor(dateTime.getTime() / 1000);

        function formatUptime(seconds) {
          const days = Math.floor(seconds / (60 * 60 * 24));
          const hours = Math.floor((seconds % (60 * 60 * 24)) / (60 * 60));
          const minutes = Math.floor((seconds % (60 * 60)) / 60);
          const secs = Math.floor(seconds % 60);

          if (days > 0) {
            return `${days} å¤© ${hours < 10 ? '0' + hours : hours} å°æ—¶ ${minutes < 10 ? '0' + minutes : minutes} åˆ† ${secs < 10 ? '0' + secs : secs} ç§’`;
          } else {
            return `${hours < 10 ? '0' + hours : hours} å°æ—¶ ${minutes < 10 ? '0' + minutes : minutes} åˆ† ${secs < 10 ? '0' + secs : secs} ç§’`;
          }
        }

        function updateUptime() {
          const now = new Date().getTime() / 1000;
          const uptimeSeconds = Math.floor(now - startTime);
          document.getElementById('runTime').textContent = 'æœ¬ç«™å·²ç¨³å®šè¿è¡Œï¼š' + formatUptime(uptimeSeconds);
        }

        updateUptime();
        setInterval(updateUptime, 1000);
      </script>
      <% } else { %>
      <span>æœ¬ç«™å·²ç¨³å®šè¿è¡Œï¼š<%= Math.ceil((new Date() - new Date(subRoot.note.getLabelValue("blogStartTime"))) / (24 * 60 * 60 * 1000)) %>å¤©</span>
      <% } %>
    </div>
    <!-- å¼€æºä¸æ˜“ï¼Œè¯·å‹¿æ³¨é‡Šä»¥ä¸‹å†…å®¹ -->
    <span>Powered by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/zadam/trilium">Trilium</a><b> X </b><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dvai/Ankia-Theme">Ankia</a></span>
  </div>
  <div>
    <span>Copyright Â© <%= subRoot.note.getLabelValue("blogStartTime").slice(0,4) %>-<%= new Date().getFullYear() %>. All Rights Reserved.</span>
  </div>
  </div>
</body>

</html>
